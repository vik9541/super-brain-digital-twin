name: Validate Documentation Links

on:
  pull_request:
    paths:
      - '**.md'
      - '.github/workflows/validate-links.yml'
  push:
    branches:
      - main
    paths:
      - '**.md'

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate GitHub links
        run: |
          python3 << 'EOF'
          import os
          import re
          import json
          
          errors = []
          warnings = []
          
          # ÐÐ°Ð¹Ñ‚Ð¸ Ð²ÑÐµ GitHub ÑÑÑ‹Ð»ÐºÐ¸ Ð² markdown Ñ„Ð°Ð¹Ð»Ð°Ñ…
          for root, dirs, files in os.walk('.'):
              # ÐŸÑ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ .git Ð¸ node_modules
              if '.git' in root or 'node_modules' in root:
                  continue
              
              for file in files:
                  if file.endswith('.md'):
                      filepath = os.path.join(root, file)
                      with open(filepath, 'r', encoding='utf-8') as f:
                          content = f.read()
                          lines = content.split('\n')
                          
                          for i, line in enumerate(lines, 1):
                              # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ GitHub ÑÑÑ‹Ð»Ð¾Ðº
                              47
                              
                                  # Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð»Ð½Ñ‹Ðµ ÑÑÑ‹Ð»ÐºÐ¸ Ñ https://
                                                      if not re.search(r'https://[^/]*github\.com', line):
                                      errors.append(f"{filepath}:{i} - Missing https:// in GitHub link")
                                  
                                  # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¿ÑƒÑ‚ÑŒ (Ñ€Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð²ÑÐµ GitHub Ð´Ð¾Ð¼ÐµÐ½Ñ‹)
                                  # Ð Ð°Ð·Ñ€ÐµÑˆÐ°ÐµÐ¼: github.com/user/, docs.github.com, api.github.com, raw.githubusercontent.com Ð¸ Ñ‚.Ð´.
                                  github_patterns = [
                                      r'https://github\.com/[a-zA-Z0-9_-]+/',  # github.com/username/
                                      r'https://docs\.github\.com/',          # docs.github.com
                                      r'https://[a-zA-Z0-9-]+\.github\.io/', # username.github.io
                                      r'https://api\.github\.com/',           # api.github.com
                                      r'https://raw\.githubusercontent\.com/', # raw.githubusercontent.com
                                      r'https://[a-zA-Z0-9-]+\.githubusercontent\.com/', # other githubusercontent.com
                                  ]
                                  valid_github_url = any(re.search(pattern, line) for pattern in github_patterns)
                                  if not valid_github_url:
                                      errors.append(f"{filepath}:{i} - Invalid GitHub URL format")
          
          # Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
          if errors:
              print("âŒ Validation Errors:")
              for error in errors:
                  print(f"  - {error}")
              exit(1)
          else:
              print("âœ… All documentation links validated successfully")
          
          if warnings:
              print("âš ï¸ Warnings:")
              for warning in warnings:
                  print(f"  - {warning}")
          EOF

      - name: Check file naming
        run: |
          python3 << 'EOF'
          import os
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÐ¾Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ñ Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð¾Ð²
          for root, dirs, files in os.walk('DEPARTMENTS'):
              for file in files:
                  if file.endswith('.md'):
                      # Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ UPPERCASE Ñ Ð¿Ð¾Ð´Ñ‡ÐµÑ€ÐºÐ¸Ð²Ð°Ð½Ð¸ÑÐ¼Ð¸
                      if not file.isupper() and file != 'README.md':
                          if not file.replace('_', '').isupper():
                              print(f"âš ï¸ Consider using UPPERCASE naming: {os.path.join(root, file)}")
          
          print("âœ… File naming check complete")
          EOF

      - name: Summary
        run: |
          echo "âœ… All validation checks passed"
          echo "ðŸ“Š Documentation is healthy and ready for production"
