# üß† FULL CONTEXT CONTACT INTELLIGENCE ‚Äî TECHNICAL SPECIFICATION
**Version:** 2.1 (Full AI Context)
**Status:** APPROVED
**Author:** Super Brain Architect & Owner

---

## 1. EXECUTIVE SUMMARY
–ú–æ–¥—É–ª—å –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—â–µ–Ω–∏—è.
**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ v2.1:** **Full Context Strategy**. –ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ AI –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–º–µ–Ω–∞, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, –∞–¥—Ä–µ—Å–∞), —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ú—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (At-Rest Encryption), —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å –∞—Ä—Ö–∏–≤—ã –æ—Ç –≤–∑–ª–æ–º–∞, –Ω–æ –∫–∞–Ω–∞–ª "Brain -> OpenAI" –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.

---

## 2. ARCHITECTURE

```mermaid
graph TD
    User[Contact Message] -->|Telegram/WhatsApp| n8n[n8n Webhook]
    n8n -->|Raw Payload| API[FastAPI Service]
    
    subgraph "Super Brain Core"
        API -->|1. Encrypt (AES-256)| DB[(Supabase Interactions)]
        API -->|2. Full Text Analysis| OpenAI[GPT-4o]
        
        subgraph "Intelligence Loop"
            OpenAI -->|Sentiment/Intent| API
            API -->|Update Profile| Vector[(pgvector)]
        end
        
        Vector -->|Semantic Search| RAG[Context Retrieval]
    end
```

---

## 3. DATA FLOW

### 3.1. Ingestion (–í—Ö–æ–¥)
1. **n8n** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.
2. **n8n** –ø–µ—Ä–µ–¥–∞–µ—Ç JSON –Ω–∞ `POST /api/v1/contact/ingest`.
3. **API**:
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–µ–∫—Ç–æ—Ä (embedding) –ø–æ *–ø–æ–ª–Ω–æ–º—É* —Ç–µ–∫—Å—Ç—É.
   - –®–∏—Ñ—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ø–æ–ª–µ `message_encrypted` (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥–∞–º–ø–æ–≤ –±–∞–∑—ã).
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç *–ø–æ–ª–Ω—ã–π* —Ç–µ–∫—Å—Ç –≤ GPT-4o –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (Sentiment, Urgency, Action Items).

### 3.2. Intelligence (–ê–Ω–∞–ª–∏–∑)
AI –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ–º–ø—Ç:
> "–¢—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {Name}. –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π: {Relationship_Context}. –í—ã–¥–µ–ª–∏ –∑–∞–¥–∞—á–∏, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Å—Ä–æ—á–Ω–æ—Å—Ç—å."

### 3.3. Response (–û—Ç–≤–µ—Ç)
–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç:
1. –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç –≤ Vector DB –ø–æ—Ö–æ–∂–∏–µ –¥–∏–∞–ª–æ–≥–∏ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ.
2. –°–∏—Å—Ç–µ–º–∞ –±–µ—Ä–µ—Ç `communication_style` —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞.
3. GPT-4o –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—è *—Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã* (–∏–º–µ–Ω–∞, –¥–∞—Ç—ã) –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏.

---

## 4. DATABASE SCHEMA (Updated)

–¢–∞–±–ª–∏—Ü—ã –æ—Å—Ç–∞—é—Ç—Å—è –∏–∑ v2.0, –Ω–æ –ø–æ–ª–µ `is_sanitized` —É–¥–∞–ª—è–µ—Ç—Å—è –∑–∞ –Ω–µ–Ω–∞–¥–æ–±–Ω–æ—Å—Ç—å—é.
–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ `message_encrypted` –æ—Å—Ç–∞–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

---

## 5. IMPLEMENTATION PLAN

### Phase 1: Core Service (Week 1)
- [ ] FastAPI Endpoint –¥–ª—è –ø—Ä–∏–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.
- [ ] AES-256 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Supabase.
- [ ] Async OpenAI client –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

### Phase 2: n8n Connection (Week 1)
- [ ] Simple Forwarder Workflow (Telegram -> API).

### Phase 3: RAG & Vectors (Week 2)
- [ ] –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏.
