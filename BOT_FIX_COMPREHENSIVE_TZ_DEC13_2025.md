# ü§ñ –ö–û–ú–ü–õ–ï–ö–°–ù–û–ï –¢–ó: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ò –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ë–û–¢–ê 

**–î–∞—Ç–∞:** 13 –¥–µ–∫–∞–±—Ä—è 2025, 21:56 MSK  
**–í–µ—Ä—Å–∏—è:** v1.0 (Complete Edition)  
**–°—Ç–∞—Ç—É—Å:** üü¢ READY FOR IMPLEMENTATION  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** CRITICAL  
**Deadline:** 1 —è–Ω–≤–∞—Ä—è 2026  

---

## üìã –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ **–≤—Å–µ—Ö –¢–ó, –∏–Ω—Ü–∏–¥–µ–Ω—Ç-—Ä–µ–ø–æ—Ä—Ç–æ–≤ –∏ —Ç–µ—Å—Ç-–æ—Ç—á–µ—Ç–æ–≤** –≤—ã—è–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

#### 1. –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (–†–ï–®–ï–ù–´)
- ‚ùå ~~DNS –º–∏—Å–º–∞—Ç—á (–±—ã–ª –Ω–∞ 8 –¥–µ–∫–∞–±—Ä—è)~~ ‚Üí ‚úÖ **–†–ï–®–ï–ù–û 9 –¥–µ–∫–∞–±—Ä—è**
- ‚úÖ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ (138.197.254.53)
- ‚úÖ LoadBalancer —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç

**–°—Ç–∞—Ç—É—Å:** üü¢ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç

#### 2. –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ë–û–¢–ê

–í —Ç–µ–∫—É—â–µ–º BOT_PERSONAL_ASSISTANT_TZ.md –æ–ø–∏—Å–∞–Ω–∞ **–Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**, –∫–æ—Ç–æ—Ä—É—é –ù–£–ñ–ù–û —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|:--------|:------:|:---------:|
| –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å —Ñ–∞–π–ª–∞–º–∏ | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | CRITICAL |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | CRITICAL |
| –ê–Ω–∞–ª–∏–∑ —á–µ–∫–æ–≤ (OCR) | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | HIGH |
| –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | HIGH |
| –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω (–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã) | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | HIGH |
| –î–Ω–µ–≤–Ω–∏–∫ –∑–¥–æ—Ä–æ–≤—å—è | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | MEDIUM |
| –†–µ–∂–∏–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | MEDIUM |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | MEDIUM |

#### 3. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

- ‚ùå –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚ùå –ù–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤
- ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º–∏
- ‚ùå –ù–µ—Ç OCR –¥–ª—è —á–µ–∫–æ–≤
- ‚ùå –ù–µ—Ç –¥–Ω–µ–≤–Ω–∏–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- ‚ùå –ö–æ–¥ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π, –Ω–µ –º–æ–¥—É–ª—å–Ω—ã–π
- ‚ùå –ù–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –≤ Supabase

---

## üéØ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò: 3 –ù–ï–î–ï–õ–ò

### –ù–ï–î–ï–õ–Ø 1 (13-19 –î–ï–ö–ê–ë–†–Ø): –§–£–ù–î–ê–ú–ï–ù–¢

#### –î–ï–ù–¨ 1: –ü–ù 13 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-001: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**

```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase PostgreSQL –∫–æ–Ω—Å–æ–ª–∏:

-- –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
CREATE TABLE user_projects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    project_name VARCHAR NOT NULL,
    description TEXT,
    status VARCHAR DEFAULT 'active', -- active, done, archived
    created_at TIMESTAMP DEFAULT NOW(),
    deadline TIMESTAMP,
    metadata JSONB DEFAULT '{}'
);

CREATE TABLE project_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID REFERENCES user_projects(id) ON DELETE CASCADE,
    file_name VARCHAR NOT NULL,
    file_url VARCHAR NOT NULL,
    file_hash VARCHAR,
    file_type VARCHAR,
    file_size INT,
    uploaded_at TIMESTAMP DEFAULT NOW(),
    tags TEXT[] DEFAULT '{}'
);

-- –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –∑–∞–¥–∞—á
CREATE TABLE user_tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    project_id UUID REFERENCES user_projects(id) ON DELETE SET NULL,
    task_description TEXT NOT NULL,
    status VARCHAR DEFAULT 'pending', -- pending, in_progress, done
    created_at TIMESTAMP DEFAULT NOW(),
    due_date TIMESTAMP,
    priority VARCHAR DEFAULT 'medium' -- low, medium, high
);

-- –¢–∞–±–ª–∏—Ü—ã –¥–ª—è —á–µ–∫–æ–≤
CREATE TABLE receipts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    store_name VARCHAR,
    store_location VARCHAR,
    receipt_date TIMESTAMP,
    total_sum DECIMAL,
    file_url VARCHAR,
    created_at TIMESTAMP DEFAULT NOW(),
    metadata JSONB DEFAULT '{}'
);

CREATE TABLE receipt_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    receipt_id UUID REFERENCES receipts(id) ON DELETE CASCADE,
    item_name VARCHAR NOT NULL,
    category VARCHAR,
    price DECIMAL,
    quantity DECIMAL,
    unit VARCHAR,
    price_per_unit DECIMAL
);

-- –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è
CREATE TABLE health_diary (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    entry_date DATE,
    entry_time TIME,
    entry_type VARCHAR, -- food, activity, habit, mood, sleep, measurement
    description TEXT,
    data JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW()
);

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE TABLE user_preferences (
    user_id VARCHAR PRIMARY KEY,
    mode VARCHAR DEFAULT 'executor', -- executor, advisor, silent, detailed
    give_advice BOOLEAN DEFAULT false,
    language VARCHAR DEFAULT 'ru',
    timezone VARCHAR DEFAULT 'Europe/Moscow',
    metadata JSONB DEFAULT '{}'
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_user_projects ON user_projects(user_id);
CREATE INDEX idx_user_tasks ON user_tasks(user_id);
CREATE INDEX idx_project_files ON project_files(project_id);
CREATE INDEX idx_receipts ON receipts(user_id);
CREATE INDEX idx_health_diary ON health_diary(user_id);
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ Supabase
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –†–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

---

#### –î–ï–ù–¨ 2: –í–¢ 14 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-002: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞**

–°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ superbrain-backend repo:

```
bots/personal-assistant-bot/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ main.py                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ commands.py                  # –í—Å–µ /–∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ projects_handler.py          # –ü—Ä–æ–µ–∫—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ tasks_handler.py             # –ó–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ receipts_handler.py          # –ß–µ–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ health_handler.py            # –ó–¥–æ—Ä–æ–≤—å–µ
‚îÇ   ‚îî‚îÄ‚îÄ settings_handler.py          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ ocr_service.py               # Google Vision API
‚îÇ   ‚îú‚îÄ‚îÄ receipt_parser.py            # –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —á–µ–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ market_service.py            # Yandex Market API
‚îÇ   ‚îú‚îÄ‚îÄ health_analytics.py          # –ê–Ω–∞–ª–∏–∑ –∑–¥–æ—Ä–æ–≤—å—è
‚îÇ   ‚îú‚îÄ‚îÄ storage_service.py           # Supabase Storage
‚îÇ   ‚îî‚îÄ‚îÄ supabase_service.py          # –ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ project.py
‚îÇ   ‚îú‚îÄ‚îÄ task.py
‚îÇ   ‚îú‚îÄ‚îÄ receipt.py
‚îÇ   ‚îú‚îÄ‚îÄ health_entry.py
‚îÇ   ‚îî‚îÄ‚îÄ user_preferences.py
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ formatter.py                 # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ validators.py                # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ helpers.py
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_handlers.py
    ‚îú‚îÄ‚îÄ test_services.py
    ‚îî‚îÄ‚îÄ test_integration.py
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –í—Å–µ –ø–∞–ø–∫–∏ –∏ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] __init__.py —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –ò–º–ø–æ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Git —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞

---

#### –î–ï–ù–¨ 3: –°–† 15 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-003: –ë–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥**

```python
# handlers/commands.py

from telegram import Update
from telegram.ext import ContextTypes
from services.supabase_service import SupabaseService

class CommandHandler:
    def __init__(self):
        self.db = SupabaseService()
    
    async def start(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ö–æ–º–∞–Ω–¥–∞ /start"""
        user_id = update.effective_user.id
        first_name = update.effective_user.first_name
        
        # –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        await self.db.ensure_user_exists(user_id)
        
        message = f"–ü—Ä–∏–≤–µ—Ç, {first_name}! üëã\n\n"
        message += "–Ø —Ç–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫!\n\n"
        message += "üìã **–ö–æ–º–∞–Ω–¥—ã:**\n"
        message += "/project list - –¢–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã\n"
        message += "/task list - –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏\n"
        message += "/receipt analyze - –ê–Ω–∞–ª–∏–∑ —á–µ–∫–∞\n"
        message += "/health diary - –î–Ω–µ–≤–Ω–∏–∫ –∑–¥–æ—Ä–æ–≤—å—è\n"
        message += "/mode executor - –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã\n"
        
        await update.message.reply_text(message, parse_mode='Markdown')
    
    async def project_list(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ö–æ–º–∞–Ω–¥–∞ /project list"""
        user_id = update.effective_user.id
        
        projects = await self.db.get_user_projects(user_id)
        
        if not projects:
            await update.message.reply_text("üìÇ –£ —Ç–µ–±—è –µ—â–µ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤.\n–°–æ–∑–¥–∞–π –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç: /project add [–Ω–∞–∑–≤–∞–Ω–∏–µ]")
            return
        
        message = "üìÇ **–¢–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã:**\n\n"
        for i, project in enumerate(projects, 1):
            message += f"{i}. {project['project_name']} ({project['status']})\n"
            message += f"   üìÑ –§–∞–π–ª–æ–≤: {len(project.get('files', []))}\n"
            message += f"   üìã –ó–∞–¥–∞—á: {len(project.get('tasks', []))}\n\n"
        
        await update.message.reply_text(message, parse_mode='Markdown')
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] /start –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] /project list —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] /task list —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ë–î

---

#### –î–ï–ù–¨ 4: –ß–¢ 16 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-004: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤**

```python
# handlers/projects_handler.py

async def project_add(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç /project add [–Ω–∞–∑–≤–∞–Ω–∏–µ]"""
    user_id = update.effective_user.id
    
    if not context.args:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /project add [–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞]")
        return
    
    project_name = ' '.join(context.args)
    
    project = await self.db.create_project(
        user_id=user_id,
        project_name=project_name,
        description=None
    )
    
    message = f"‚úÖ –ü—Ä–æ–µ–∫—Ç '{project_name}' —Å–æ–∑–¥–∞–Ω!\n\n"
    message += "üìé –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª: /project upload\n"
    message += "üìã –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É: /task add [–æ–ø–∏—Å–∞–Ω–∏–µ]\n"
    
    await update.message.reply_text(message)

async def project_upload(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –≤ –ø—Ä–æ–µ–∫—Ç"""
    if not update.message.document:
        await update.message.reply_text("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç")
        return
    
    file = update.message.document
    user_id = update.effective_user.id
    
    # –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
    file_path = await file.download()
    
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Supabase Storage
    file_url = await self.storage.upload_file(
        bucket='projects',
        path=f"{user_id}/{file.file_name}",
        file_path=file_path
    )
    
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
    await self.db.save_project_file(
        project_id=None,  # –ü–æ–∫–∞ –±–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞
        file_name=file.file_name,
        file_url=file_url,
        file_size=file.file_size,
        file_type=file.mime_type
    )
    
    await update.message.reply_text(f"‚úÖ –§–∞–π–ª '{file.file_name}' –∑–∞–≥—Ä—É–∂–µ–Ω!")
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] /project add —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] /project upload —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase Storage
- [ ] –î–∞–Ω–Ω—ã–µ –≤ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

---

#### –î–ï–ù–¨ 5: –ü–¢ 17 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-005: –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏**

```python
# handlers/tasks_handler.py

async def task_add(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É /task add [–æ–ø–∏—Å–∞–Ω–∏–µ]"""
    user_id = update.effective_user.id
    
    if not context.args:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /task add [–æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏]")
        return
    
    task_description = ' '.join(context.args)
    
    task = await self.db.create_task(
        user_id=user_id,
        task_description=task_description,
        priority='medium'
    )
    
    await update.message.reply_text(f"‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞: '{task_description}'")

async def task_list(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á /task list"""
    user_id = update.effective_user.id
    
    tasks = await self.db.get_user_tasks(user_id, status='pending')
    
    if not tasks:
        await update.message.reply_text("‚úÖ –£ —Ç–µ–±—è –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á!")
        return
    
    message = "üìã **–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:**\n\n"
    for i, task in enumerate(tasks, 1):
        priority_emoji = {"high": "üî¥", "medium": "üü°", "low": "üü¢"}.get(task['priority'], "‚ö™")
        message += f"{i}. {priority_emoji} {task['task_description']}\n"
    
    await update.message.reply_text(message, parse_mode='Markdown')

async def task_done(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π /task done [id]"""
    if not context.args:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /task done [–Ω–æ–º–µ—Ä –∑–∞–¥–∞—á–∏]")
        return
    
    task_id = context.args[0]
    await self.db.update_task_status(task_id, 'done')
    
    await update.message.reply_text("‚úÖ –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] /task add —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] /task list —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] /task done —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –ë–î

---

#### –î–ï–ù–¨ 6-7: –°–ë-–í–° 18-19 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-006: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ù–ï–î–ï–õ–ò 1**

```bash
# –ü—Ä–æ–≥–Ω–∞—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
python -m pytest tests/ -v

# –¢–µ—Å—Ç –Ω–∞—á–∏–Ω–∞—è —Å /start
1. /start ‚Üí –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Å –º–µ–Ω—é
2. /project add "–¢–µ—Å—Ç" ‚Üí –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
3. /task add "–¢–µ—Å—Ç –∑–∞–¥–∞—á–∞" ‚Üí –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
4. /project list ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
5. /task list ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–¥–∞—á—É
6. /task done 1 ‚Üí –¥–æ–ª–∂–µ–Ω –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ù–ï–î–ï–õ–ò 1 —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ë–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–∞ 100%

---

### –ù–ï–î–ï–õ–Ø 2 (20-26 –î–ï–ö–ê–ë–†–Ø): –ê–ù–ê–õ–ò–ó –ß–ï–ö–û–í

#### –î–ï–ù–¨ 8: –ü–ù 20 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-007: Google Vision API (OCR)**

```python
# services/ocr_service.py

from google.cloud import vision
import os

class OCRService:
    def __init__(self):
        self.client = vision.ImageAnnotatorClient()
    
    async def extract_text_from_image(self, image_path: str) -> str:
        """–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç —Å–æ —Å–∫–∞–Ω–∞/—Ñ–æ—Ç–æ"""
        with open(image_path, 'rb') as image_file:
            image = vision.Image(content=image_file.read())
        
        response = self.client.text_detection(image=image)
        texts = response.text_annotations
        
        if texts:
            return texts[0].description
        return None
    
    async def extract_from_url(self, image_url: str) -> str:
        """–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç —Å URL"""
        image = vision.Image()
        image.source.image_uri = image_url
        
        response = self.client.text_detection(image=image)
        texts = response.text_annotations
        
        if texts:
            return texts[0].description
        return None
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] Google Cloud API –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] OCR Service —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

#### –î–ï–ù–¨ 9: –í–¢ 21 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-008: –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —á–µ–∫–∞**

```python
# services/receipt_parser.py

from typing import Dict, List
from datetime import datetime
import re

class ReceiptParser:
    
    async def parse_receipt_text(self, text: str) -> Dict:
        """–ü–∞—Ä—Å–∏—Ç —Ç–µ–∫—Å—Ç —á–µ–∫–∞ –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É"""
        
        parsed = {
            'store_name': self._extract_store_name(text),
            'receipt_date': self._extract_date(text),
            'receipt_time': self._extract_time(text),
            'items': self._extract_items(text),
            'total_sum': self._extract_total(text),
            'address': self._extract_address(text),
            'raw_text': text
        }
        
        return parsed
    
    def _extract_store_name(self, text: str) -> str:
        """–ù–∞–π—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞"""
        stores = {
            '–ø—è—Ç—ë—Ä–æ—á–∫–∞': '–ü—è—Ç—ë—Ä–æ—á–∫–∞',
            '–º–µ—Ç—Ä–æ': '–ú–µ—Ç—Ä–æ',
            '–∞—à–∞–Ω': '–ê—à–∞–Ω',
            '–¥–∏–∫—Å–∏': '–î–∏–∫—Å–∏',
            '–æ–∫–µ–π': '–û–∫–µ–π',
            'magnit': '–ú–∞–≥–Ω–∏—Ç',
            '–º–∞—Ä—à–∞–ª': '–ú–∞—Ä—à–∞–ª'
        }
        
        text_lower = text.lower()
        for key, value in stores.items():
            if key in text_lower:
                return value
        return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω'
    
    def _extract_items(self, text: str) -> List[Dict]:
        """–ò–∑–≤–ª–µ—á—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤"""
        items = []
        
        # –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Ü–µ–Ω
        pattern = r'([\w\s]+)\s+(\d+[.,]\d{2})'
        matches = re.findall(pattern, text)
        
        for item_name, price in matches:
            items.append({
                'name': item_name.strip(),
                'price': float(price.replace(',', '.')),
                'category': self._categorize_item(item_name)
            })
        
        return items
    
    def _categorize_item(self, item_name: str) -> str:
        """–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–∞"""
        categories = {
            '–º–æ–ª–æ—á–∫–∞': ['–º–æ–ª–æ–∫–æ', '–π–æ–≥—É—Ä—Ç', '–º–∞—Å–ª–æ', '—Å—ã—Ä', '–∫–µ—Ñ–∏—Ä'],
            '–º—è—Å–æ': ['–∫—É—Ä–∏—Ü–∞', '—Ñ–∏–ª–µ', '–≥–æ–≤—è–¥–∏–Ω–∞', '—Å–≤–∏–Ω–∏–Ω–∞', '–∫–æ–ª–±–∞—Å–∞'],
            '—Ö–ª–µ–±': ['—Ö–ª–µ–±', '–±—É–ª–∫–∞', '–±–∞—Ç–æ–Ω'],
            '–Ω–∞–ø–∏—Ç–∫–∏': ['—Å–æ–∫', '–≤–æ–¥–∞', '—á–∞–π', '–∫–æ—Ñ–µ', '–Ω–∞–ø–∏—Ç–æ–∫'],
            '—Ñ—Ä—É–∫—Ç—ã': ['—è–±–ª–æ–∫–æ', '–±–∞–Ω–∞–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω', '–≥—Ä—É—à–∞'],
            '–æ–≤–æ—â–∏': ['–ø–æ–º–∏–¥–æ—Ä', '–æ–≥—É—Ä–µ—Ü', '—Å–∞–ª–∞—Ç', '–º–æ—Ä–∫–æ–≤—å']
        }
        
        item_lower = item_name.lower()
        for category, keywords in categories.items():
            if any(keyword in item_lower for keyword in keywords):
                return category
        
        return '–ø—Ä–æ—á–µ–µ'
    
    def _extract_total(self, text: str) -> float:
        """–ò–∑–≤–ª–µ—á—å —Å—É–º–º—É"""
        # –ò—â–µ–º "–ò–¢–û–ì–û:", "–°–£–ú–ú–ê:", "TOTAL:" –∏ —Å–ª–µ–¥—É—é—â–µ–µ —á–∏—Å–ª–æ
        pattern = r'(?:–∏—Ç–æ–≥–æ|—Å—É–º–º–∞|total)[:\s]+(\d+[.,]\d{2})'
        match = re.search(pattern, text, re.IGNORECASE)
        
        if match:
            return float(match.group(1).replace(',', '.'))
        return 0.0
    
    def _extract_date(self, text: str) -> str:
        """–ò–∑–≤–ª–µ—á—å –¥–∞—Ç—É"""
        pattern = r'(\d{2}[./]\d{2}[./]\d{4})'
        match = re.search(pattern, text)
        return match.group(1) if match else None
    
    def _extract_time(self, text: str) -> str:
        """–ò–∑–≤–ª–µ—á—å –≤—Ä–µ–º—è"""
        pattern = r'(\d{2}:\d{2})'
        match = re.search(pattern, text)
        return match.group(1) if match else None
    
    def _extract_address(self, text: str) -> str:
        """–ò–∑–≤–ª–µ—á—å –∞–¥—Ä–µ—Å –º–∞–≥–∞–∑–∏–Ω–∞"""
        pattern = r'(?:—É–ª\.?|—É–ª–∏—Ü–∞)\s+([\w\s.,]+)'
        match = re.search(pattern, text)
        return match.group(1) if match else None
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –ü–∞—Ä—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö —á–µ–∫–æ–≤
- [ ] –¢–æ–≤–∞—Ä—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°—É–º–º–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è

---

#### –î–ï–ù–¨ 10: –°–† 22 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-009: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —á–µ–∫–æ–≤ –≤ –±–æ—Ç–∞**

```python
# handlers/receipts_handler.py

from PIL import Image
import io

class ReceiptsHandler:
    def __init__(self):
        self.ocr = OCRService()
        self.parser = ReceiptParser()
        self.db = SupabaseService()
    
    async def analyze_receipt(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–æ—Ç–æ —á–µ–∫–∞"""
        user_id = update.effective_user.id
        
        if not update.message.photo:
            await update.message.reply_text("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —á–µ–∫–∞")
            return
        
        # –°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ
        photo = update.message.photo[-1]
        file = await photo.get_file()
        file_path = f"/tmp/{file.file_id}.jpg"
        await file.download(file_path)
        
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –æ–±—Ä–∞–±–æ—Ç–∫–µ
        processing_msg = await update.message.reply_text("‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —á–µ–∫...")
        
        try:
            # –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç
            text = await self.ocr.extract_text_from_image(file_path)
            
            if not text:
                await update.message.reply_text("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –±–æ–ª–µ–µ —è—Å–Ω–æ–µ —Ñ–æ—Ç–æ")
                return
            
            # –ü–∞—Ä—Å–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            parsed = await self.parser.parse_receipt_text(text)
            
            # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
            receipt = await self.db.save_receipt(
                user_id=user_id,
                store_name=parsed['store_name'],
                receipt_date=parsed['receipt_date'],
                total_sum=parsed['total_sum'],
                items=parsed['items'],
                file_path=file_path
            )
            
            # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            message = self._format_receipt_analysis(parsed)
            await update.message.reply_text(message, parse_mode='Markdown')
            
        except Exception as e:
            await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")
        
        finally:
            # –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            await context.bot.delete_message(
                chat_id=update.effective_chat.id,
                message_id=processing_msg.message_id
            )
    
    def _format_receipt_analysis(self, parsed: Dict) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞"""
        message = f"‚úÖ **–ß–µ–∫ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:**\n\n"
        message += f"üè™ **{parsed['store_name']}**\n"
        message += f"üìÖ {parsed['receipt_date']} {parsed['receipt_time']}\n\n"
        
        message += "üõí **–¢–æ–≤–∞—Ä—ã:**\n"
        total = 0
        for item in parsed['items']:
            message += f"‚Ä¢ {item['name']} - {item['price']}‚ÇΩ\n"
            total += item['price']
        
        message += f"\nüí∞ **–ò–¢–û–ì–û: {parsed['total_sum']}‚ÇΩ**\n"
        
        return message
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] /receipt analyze —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –§–æ—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- [ ] –ß–µ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

#### –î–ï–ù–¨ 11: –ß–¢ 23 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-010: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω (Yandex Market API)**

```python
# services/market_service.py

import aiohttp
import os

class MarketService:
    def __init__(self):
        self.yandex_token = os.getenv('YANDEX_MARKET_API_KEY')
        self.base_url = "https://api.market.yandex.ru/v2/search"
    
    async def find_cheaper_items(self, items: List[Dict]) -> List[Dict]:
        """–ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä—ã –¥–µ—à–µ–≤–ª–µ –≤ –¥—Ä—É–≥–∏—Ö –º–∞–≥–∞–∑–∏–Ω–∞—Ö"""
        results = []
        
        async with aiohttp.ClientSession() as session:
            for item in items:
                cheaper_options = await self._search_item(session, item)
                if cheaper_options:
                    results.append(cheaper_options)
        
        return results
    
    async def _search_item(self, session: aiohttp.ClientSession, item: Dict) -> Dict:
        """–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é"""
        params = {
            'text': item['name'],
            'pageId': 1
        }
        
        headers = {
            'Authorization': f'Bearer {self.yandex_token}'
        }
        
        try:
            async with session.get(
                self.base_url,
                params=params,
                headers=headers,
                timeout=aiohttp.ClientTimeout(total=5)
            ) as resp:
                if resp.status == 200:
                    data = await resp.json()
                    
                    if data.get('search', {}).get('results'):
                        results = data['search']['results']
                        
                        # –ù–∞–π—Ç–∏ —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π
                        cheapest = min(results, key=lambda x: x.get('price', float('inf')))
                        
                        if cheapest['price'] < item['price']:
                            return {
                                'item_name': item['name'],
                                'original_price': item['price'],
                                'cheaper_price': cheapest['price'],
                                'savings': item['price'] - cheapest['price'],
                                'store': cheapest.get('shop', 'Unknown'),
                                'url': cheapest.get('url')
                            }
        except Exception as e:
            print(f"Error searching {item['name']}: {e}")
        
        return None
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] Yandex Market API –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è

---

#### –î–ï–ù–¨ 12-13: –ü–¢-–í–° 24-25 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-011: –î–Ω–µ–≤–Ω–∏–∫ –∑–¥–æ—Ä–æ–≤—å—è**

```python
# handlers/health_handler.py

class HealthHandler:
    async def record_health(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ó–∞–ø–∏—Å–∞—Ç—å –≤ –¥–Ω–µ–≤–Ω–∏–∫ –∑–¥–æ—Ä–æ–≤—å—è"""
        user_id = update.effective_user.id
        text = update.message.text
        
        # –ü–∞—Ä—Å–∏—Ç—å —á—Ç–æ –∑–∞–ø–∏—Å–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        # –ü—Ä–∏–º–µ—Ä—ã:
        # - "–°—ä–µ–ª –º–æ–ª–æ–∫–æ"
        # - "–ü–æ—à–µ–ª –∫—É—Ä–∏—Ç—å"
        # - "–ü—Ä–æ–µ—Ö–∞–ª—Å—è –Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–µ"
        # - "–°–ø–∞–ª 8 —á–∞—Å–æ–≤"
        
        entry_type, data = self._parse_health_entry(text)
        
        await self.db.save_health_entry(
            user_id=user_id,
            entry_type=entry_type,
            data=data
        )
        
        if entry_type == 'food':
            emoji = "üçΩÔ∏è"
            category = "–ï–¥–∞"
        elif entry_type == 'habit':
            emoji = "üßò"
            category = "–ü—Ä–∏–≤—ã—á–∫–∞"
        elif entry_type == 'activity':
            emoji = "üö¥"
            category = "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
        else:
            emoji = "üìù"
            category = "–ó–∞–ø–∏—Å—å"
        
        await update.message.reply_text(f"{emoji} –ó–∞–ø–∏—Å–∞–Ω–æ –≤ –¥–Ω–µ–≤–Ω–∏–∫: {category}")
    
    def _parse_health_entry(self, text: str) -> tuple:
        """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –∏ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∑–∞–ø–∏—Å—å"""
        text_lower = text.lower()
        
        # –ï–¥–∞
        food_keywords = ['—Å—ä–µ–ª', '—Å—ä–µ–ª–∞', '–≤—ã–ø–∏–ª', '–≤—ã–ø–∏–ª–∞', '–ø–æ–µ–ª', '–ø–æ–ø–∏–ª']
        if any(kw in text_lower for kw in food_keywords):
            return 'food', {'description': text}
        
        # –ü—Ä–∏–≤—ã—á–∫–∞
        habit_keywords = ['–∫—É—Ä–∏–ª', '–∫—É—Ä–∏–ª–∞', '–ø–∏–ª', '–ø–∏–ª–∞']
        if any(kw in text_lower for kw in habit_keywords):
            return 'habit', {'description': text}
        
        # –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        activity_keywords = ['–ø–æ—à–µ–ª', '–ø–æ—à–ª–∞', '–ø—Ä–æ–µ—Ö–∞–ª', '–∑–∞–Ω–∏–º–∞–ª—Å—è']
        if any(kw in text_lower for kw in activity_keywords):
            return 'activity', {'description': text}
        
        # –°–æ–Ω
        if '—Å–ø–∞–ª' in text_lower or '—Å–ø–∞–ª–∞' in text_lower:
            return 'sleep', {'description': text}
        
        return 'note', {'description': text}
    
    async def health_report(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–í—ã–≤–µ—Å—Ç–∏ –æ—Ç—á–µ—Ç –æ –∑–¥–æ—Ä–æ–≤—å–µ /health report"""
        user_id = update.effective_user.id
        
        entries = await self.db.get_health_entries(user_id, days=1)
        
        message = "üìä **–û–¢–ß–ï–¢ –û –ó–î–û–†–û–í–¨–ï (–°–µ–≥–æ–¥–Ω—è)**\n\n"
        
        if not entries:
            message += "–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç."
            await update.message.reply_text(message, parse_mode='Markdown')
            return
        
        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–∏–ø–∞–º
        by_type = {}
        for entry in entries:
            entry_type = entry['entry_type']
            if entry_type not in by_type:
                by_type[entry_type] = []
            by_type[entry_type].append(entry)
        
        for entry_type, items in by_type.items():
            if entry_type == 'food':
                message += "üçΩÔ∏è **–ü–ò–¢–ê–ù–ò–ï:**\n"
                for item in items:
                    message += f"‚Ä¢ {item['data'].get('description', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
            elif entry_type == 'habit':
                message += "\nüßò **–ü–†–ò–í–´–ß–ö–ò:**\n"
                for item in items:
                    message += f"‚Ä¢ {item['data'].get('description', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
            elif entry_type == 'activity':
                message += "\nüí™ **–ê–ö–¢–ò–í–ù–û–°–¢–¨:**\n"
                for item in items:
                    message += f"‚Ä¢ {item['data'].get('description', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        
        await update.message.reply_text(message, parse_mode='Markdown')
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] /health diary —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ó–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- [ ] /health report –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- [ ] –ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –ù–ï–î–ï–õ–Ø 3 (26-31 –î–ï–ö–ê–ë–†–Ø): –ü–û–õ–ò–†–û–í–ö–ê –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

#### –î–ï–ù–¨ 14-15: –ü–¢-–í–° 26-27 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-012: –†–µ–∂–∏–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

```python
# handlers/settings_handler.py

class SettingsHandler:
    async def set_mode(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∂–∏–º /mode [—Ä–µ–∂–∏–º]"""
        if not context.args:
            modes = ['executor', 'advisor', 'silent', 'detailed']
            message = "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã:\n"
            for mode in modes:
                message += f"‚Ä¢ /mode {mode}\n"
            await update.message.reply_text(message)
            return
        
        mode = context.args[0].lower()
        valid_modes = ['executor', 'advisor', 'silent', 'detailed']
        
        if mode not in valid_modes:
            await update.message.reply_text(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º '{mode}'")
            return
        
        user_id = update.effective_user.id
        await self.db.update_user_preferences(user_id, mode=mode)
        
        mode_descriptions = {
            'executor': '–¢–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω—è—é –∑–∞–¥–∞—á–∏, –±–µ–∑ —Å–æ–≤–µ—Ç–æ–≤',
            'advisor': '–î–∞—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —Å–æ–≤–µ—Ç—ã',
            'silent': '–ú–∏–Ω–∏–º—É–º —Ç–µ–∫—Å—Ç–∞, —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã',
            'detailed': '–ü–æ–¥—Ä–æ–±–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –≤—Å–µ–≥–æ'
        }
        
        message = f"‚úÖ –†–µ–∂–∏–º '{mode}' –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!\n\n"
        message += f"üìù {mode_descriptions[mode]}"
        
        await update.message.reply_text(message)
```

---

#### –î–ï–ù–¨ 16-17: –ü–ù-–í–¢ 29-30 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-013: –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

```bash
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–ï–°–¢ 1: –ü—Ä–æ–µ–∫—Ç—ã
‚úÖ /start
‚úÖ /project add "–ú–æ–π –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç"
‚úÖ /project list
‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª

–¢–ï–°–¢ 2: –ó–∞–¥–∞—á–∏
‚úÖ /task add "–ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ"
‚úÖ /task list
‚úÖ /task done 1

–¢–ï–°–¢ 3: –ß–µ–∫–∏
‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ —á–µ–∫–∞
‚úÖ /receipt analyze
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω

–¢–ï–°–¢ 4: –ó–¥–æ—Ä–æ–≤—å–µ
‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å "–°—ä–µ–ª –º–æ–ª–æ–∫–æ"
‚úÖ /health report
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É

–¢–ï–°–¢ 5: –†–µ–∂–∏–º—ã
‚úÖ /mode executor
‚úÖ /mode advisor
‚úÖ /mode silent

–¢–ï–°–¢ 6: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚úÖ –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫
- [ ] –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è

---

#### –î–ï–ù–¨ 18: –°–† 31 –î–ï–ö–ê–ë–†–Ø
**TASK-BOT-FIX-014: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ production

1. –û–±–Ω–æ–≤–∏—Ç—å –≤ Kubernetes:
   kubectl apply -f k8s/bot-deployment.yaml
   kubectl rollout status deployment/digital-twin-bot

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   kubectl logs -f deployment/digital-twin-bot

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å health check:
   curl https://97v.ru/health

4. –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:
   - BOT_USER_GUIDE.md (–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è)
   - BOT_API_DOCUMENTATION.md (API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π)
   - BOT_TROUBLESHOOTING.md (—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º)

5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç:
   python run_integration_tests.py
```

---

## üìä SUMMARY

### –ß—Ç–æ –±—ã–ª–æ:
‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Kubernetes, DNS, API)
‚ùå –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–∞

### –ß—Ç–æ –±—É–¥–µ—Ç (–ø–æ—Å–ª–µ 1 —è–Ω–≤–∞—Ä—è 2026):
‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏
‚úÖ –ê–Ω–∞–ª–∏–∑ —á–µ–∫–æ–≤
‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω
‚úÖ –î–Ω–µ–≤–Ω–∏–∫ –∑–¥–æ—Ä–æ–≤—å—è
‚úÖ –†–µ–∂–∏–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### KPI –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é:
- üéØ 14+ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- üéØ 100+ —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- üéØ 80+ —Ç–µ—Å—Ç–æ–≤ (–≤—Å–µ –∑–µ–ª–µ–Ω—ã–µ)
- üéØ 0 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- üéØ <100ms moyenne response time

---

## üöÄ –°–¢–ê–†–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

**–ù–ê–ß–ò–ù–ê–ï–ú: 13 –î–ï–ö–ê–ë–†–Ø 2025, 22:00 MSK**

```bash
# –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/vik9541/superbrain-backend.git
cd superbrain-backend

# –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É
git checkout -b feature/personal-assistant-bot

# –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
pip install google-cloud-vision aiohttp python-telegram-bot supabase

# –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç
python -m pytest tests/test_handlers.py -v

# –®–∞–≥ 5: –ù–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É
echo "–î–ï–ù–¨ 1: TASK-BOT-FIX-001 –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É!"
```

---

**–°—Ç–∞—Ç—É—Å:** üü¢ READY TO IMPLEMENT  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL  
**Deadline:** üéØ 1 –Ø–ù–í–ê–†–Ø 2026  
**–ó–∞–¥–∞—á:** 14 (TASK-BOT-FIX-001 to 014)  

> üöÄ **–ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ô –ü–û–ú–û–©–ù–ò–ö –ë–û–¢ - –ü–û–õ–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø!**
