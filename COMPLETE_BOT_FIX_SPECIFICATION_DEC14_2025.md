# üìò –ü–û–õ–ù–ê–Ø –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

**–î–∞—Ç–∞:** 14 –¥–µ–∫–∞–±—Ä—è 2025, 09:04 MSK  
**–í–µ—Ä—Å–∏—è:** 2.0 COMPLETE  
**–°—Ç–∞—Ç—É—Å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê  
**–¶–µ–ª—å:** –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –±–æ—Ç –≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞  
**Deadline:** 14 –¥–µ–∫–∞–±—Ä—è 2025, 18:00 MSK  

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã](#–∞–Ω–∞–ª–∏–∑-–ø—Ä–æ–±–ª–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
3. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
4. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–æ–¥—É–ª—è–º](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-–ø–æ-–º–æ–¥—É–ª—è–º)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
6. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)

---

## üî¥ –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)

```python
# –°–µ–π—á–∞—Å –≤ –∫–æ–¥–µ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ):
async def handle_message(update, context):
    text = update.message.text
    
    # ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–¥–µ—Ç –≤ Perplexity
    response = await perplexity_api.search(text)
    
    # ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –î–ª–∏–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –≤–º–µ—Å—Ç–æ –∫–æ—Ä–æ—Ç–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
    await update.message.reply_text(response)  # 5000+ —Å–∏–º–≤–æ–ª–æ–≤
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚ùå "–ü—Ä–∏—à–µ–ª –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ 7.50" ‚Üí —Å—Ç–∞—Ç—å—è –ø—Ä–æ –¢–ö –†–§ –∏ —Ç—Ä—É–¥–æ–≤–æ–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ
- ‚ùå "–í—Å—Ç—Ä–µ—á–∞–ª—Å—è —Å –ê–Ω—Ç–æ–Ω–æ–º –ù–æ—Å–∫–æ–≤—ã–º" ‚Üí –ø–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –ø—Ä–æ –≤—Å–µ—Ö –ê–Ω—Ç–æ–Ω–æ–≤ –ù–æ—Å–∫–æ–≤—ã—Ö
- ‚ùå –§–æ—Ç–æ —á–µ–∫–∞ ‚Üí "–û–ø–∏—à–∏—Ç–µ —á—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ"
- ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- ‚ùå –ù–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç

### –¢—Ä–µ–±—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ü–†–ê–í–ò–õ–¨–ù–û)

```python
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
async def handle_message(update, context):
    text = update.message.text
    user_id = update.effective_user.id
    
    # ‚úÖ 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ë–ï–ó –≤–Ω–µ—à–Ω–∏—Ö API
    intent = intent_classifier.classify(text, has_photo=bool(update.message.photo))
    
    # ‚úÖ 2. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
    if intent == "WORK_LOG":
        response = await work_tracker.log(user_id, text)
    elif intent == "CONTACT_MENTION":
        response = await contacts_handler.process(user_id, text)
    elif intent == "RECEIPT":
        response = await receipt_analyzer.process(update.message.photo)
    # ...
    
    # ‚úÖ 3. –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç (1-3 —Å—Ç—Ä–æ–∫–∏)
    await update.message.reply_text(response)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ "–ü—Ä–∏—à–µ–ª –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ 7.50" ‚Üí "üìç –ó–∞–ø–∏—Å–∞–Ω–æ: –ø—Ä–∏—Ö–æ–¥ –≤ 7:50"
- ‚úÖ "–í—Å—Ç—Ä–µ—á–∞–ª—Å—è —Å –ê–Ω—Ç–æ–Ω–æ–º –ù–æ—Å–∫–æ–≤—ã–º" ‚Üí –ø–æ–∏—Å–∫ –≤ –°–í–û–ï–ô –±–∞–∑–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ + –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
- ‚úÖ –§–æ—Ç–æ —á–µ–∫–∞ ‚Üí OCR + "üßæ –ß–µ–∫: –ü—è—Ç—ë—Ä–æ—á–∫–∞, 385‚ÇΩ"
- ‚úÖ –í–µ–¥–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –∫–æ–Ω—Ç–∞–∫—Ç—É
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ï–®–ï–ù–ò–Ø

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—á—Ç–æ —É–∂–µ –µ—Å—Ç—å)

```
bots/personal-assistant-bot/
‚îú‚îÄ‚îÄ main.py                          # ‚úÖ –ï—Å—Ç—å
‚îú‚îÄ‚îÄ config.py                        # ‚úÖ –ï—Å—Ç—å
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ commands.py                  # ‚úÖ –ï—Å—Ç—å (/start, /help)
‚îÇ   ‚îú‚îÄ‚îÄ projects_handler.py          # ‚úÖ –ï—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ tasks_handler.py             # ‚úÖ –ï—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ receipts_handler.py          # ‚úÖ –ï—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ health_handler.py            # ‚úÖ –ï—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ unified.py                   # ‚ö†Ô∏è –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
‚îÇ   ‚îî‚îÄ‚îÄ dispatcher.py                # ‚ö†Ô∏è –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ supabase_service.py          # ‚úÖ –ï—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ ocr_service.py               # ‚úÖ –ï—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ receipt_parser.py            # ‚úÖ –ï—Å—Ç—å
‚îÇ   ‚îî‚îÄ‚îÄ ...                          # ‚úÖ –ï—Å—Ç—å
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å/–∏—Å–ø—Ä–∞–≤–∏—Ç—å

```
‚ùå –£–î–ê–õ–ò–¢–¨/–û–¢–ö–õ–Æ–ß–ò–¢–¨:
‚îî‚îÄ‚îÄ perplexity_integration.py (–∏–ª–∏ –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–∏—Å–∫)

‚úÖ –°–û–ó–î–ê–¢–¨:
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ intent_classifier.py         # üÜï –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–Ω—Ç–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ contacts_manager.py          # üÜï –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ context_manager.py           # üÜï –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ contacts_handler.py          # üÜï –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ª—é–¥–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ work_tracker_handler.py      # üÜï –£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

‚ö†Ô∏è –ò–°–ü–†–ê–í–ò–¢–¨:
‚îú‚îÄ‚îÄ handlers/unified.py              # –£–±—Ä–∞—Ç—å Perplexity, –¥–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥
‚îî‚îÄ‚îÄ handlers/dispatcher.py           # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IntentClassifier
```

---

## üíæ –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã

```sql
-- ‚úÖ –£–ñ–ï –ï–°–¢–¨:
users, projects, project_files, user_tasks, receipts, 
receipt_items, health_entries, user_preferences
```

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–°–û–ó–î–ê–¢–¨)

```sql
-- ========================================
-- –¢–ê–ë–õ–ò–¶–ê 1: –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
-- ========================================
CREATE TABLE IF NOT EXISTS contacts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    
    -- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    full_name VARCHAR NOT NULL,
    first_name VARCHAR,
    last_name VARCHAR,
    middle_name VARCHAR,
    
    -- –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    phone VARCHAR,
    email VARCHAR,
    telegram_username VARCHAR,
    
    -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    company VARCHAR,
    position VARCHAR,
    location VARCHAR,
    
    -- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    birthday DATE,
    notes TEXT,
    tags TEXT[],
    
    -- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è)
    personality_traits JSONB DEFAULT '{}',  -- –ß–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞
    habits TEXT[],                          -- –ü—Ä–∏–≤—ã—á–∫–∏
    interests TEXT[],                       -- –ò–Ω—Ç–µ—Ä–µ—Å—ã
    
    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    -- –ò–Ω–¥–µ–∫—Å—ã
    CONSTRAINT unique_contact_per_user UNIQUE(user_id, full_name)
);

CREATE INDEX idx_contacts_user_id ON contacts(user_id);
CREATE INDEX idx_contacts_full_name ON contacts(user_id, full_name);

-- ========================================
-- –¢–ê–ë–õ–ò–¶–ê 2: –ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
-- ========================================
CREATE TABLE IF NOT EXISTS contact_interactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    contact_id UUID REFERENCES contacts(id) ON DELETE CASCADE,
    
    -- –¢–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
    type VARCHAR NOT NULL,  -- meeting, call, message, email
    
    -- –î–µ—Ç–∞–ª–∏
    title VARCHAR,
    description TEXT,
    location VARCHAR,
    
    -- –ö–æ–≥–¥–∞
    interaction_date DATE,
    interaction_time TIME,
    
    -- –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
    raw_text TEXT,
    
    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_interactions_user ON contact_interactions(user_id);
CREATE INDEX idx_interactions_contact ON contact_interactions(contact_id);
CREATE INDEX idx_interactions_date ON contact_interactions(interaction_date DESC);

-- ========================================
-- –¢–ê–ë–õ–ò–¶–ê 3: –°–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
-- ========================================
CREATE TABLE IF NOT EXISTS contact_relationships (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    contact_id_1 UUID REFERENCES contacts(id) ON DELETE CASCADE,
    contact_id_2 UUID REFERENCES contacts(id) ON DELETE CASCADE,
    
    -- –¢–∏–ø —Å–≤—è–∑–∏
    relationship_type VARCHAR,  -- family, colleague, friend, client
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- ========================================
-- –¢–ê–ë–õ–ò–¶–ê 4: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
-- ========================================
CREATE TABLE IF NOT EXISTS conversation_context (
    user_id VARCHAR PRIMARY KEY,
    
    -- –ü–æ—Å–ª–µ–¥–Ω–∏–π —É–ø–æ–º—è–Ω—É—Ç—ã–π –∫–æ–Ω—Ç–∞–∫—Ç
    last_mentioned_contact_id UUID REFERENCES contacts(id),
    last_mentioned_name VARCHAR,
    last_mention_time TIMESTAMP,
    
    -- –¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç
    current_project_id UUID,
    
    -- –û–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    context_data JSONB DEFAULT '{}',
    
    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ========================================
-- –¢–ê–ë–õ–ò–¶–ê 5: –£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
-- ========================================
CREATE TABLE IF NOT EXISTS work_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    
    -- –¢–∏–ø —Å–æ–±—ã—Ç–∏—è
    log_type VARCHAR NOT NULL,  -- arrival, departure, break_start, break_end
    
    -- –í—Ä–µ–º—è
    log_date DATE NOT NULL,
    log_time TIME NOT NULL,
    
    -- –õ–æ–∫–∞—Ü–∏—è
    location VARCHAR,
    
    -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
    notes TEXT,
    raw_text TEXT,
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_work_logs_user ON work_logs(user_id, log_date DESC);

-- ========================================
-- –¢–ê–ë–õ–ò–¶–ê 6: –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è ML)
-- ========================================
CREATE TABLE IF NOT EXISTS message_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id VARCHAR NOT NULL,
    
    -- –°–æ–æ–±—â–µ–Ω–∏–µ
    message_text TEXT,
    has_photo BOOLEAN DEFAULT false,
    
    -- –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ–Ω—Ç
    detected_intent VARCHAR,
    intent_confidence FLOAT,
    
    -- –û—Ç–≤–µ—Ç –±–æ—Ç–∞
    bot_response TEXT,
    
    -- Timestamp
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_messages_user ON message_history(user_id, created_at DESC);
```

---

## üîß –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û –ú–û–î–£–õ–Ø–ú

### –ú–û–î–£–õ–¨ 1: Intent Classifier (–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞–º–µ—Ä–µ–Ω–∏–π)

**–§–∞–π–ª:** `services/intent_classifier.py`

```python
"""
–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–ï–ó –≤–Ω–µ—à–Ω–∏—Ö API.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤.
"""

import re
from typing import Dict, List, Tuple
from datetime import datetime


class IntentClassifier:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–µ–∫—Å—Ç—É —Å–æ–æ–±—â–µ–Ω–∏—è.
    –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω–∏–µ API - —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞.
    """
    
    # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ–Ω—Ç–∞
    INTENT_KEYWORDS = {
        'WORK_LOG': [
            '–ø—Ä–∏—à–µ–ª –Ω–∞ —Ä–∞–±–æ—Ç—É', '–ø—Ä–∏—à—ë–ª –Ω–∞ —Ä–∞–±–æ—Ç—É',
            '–ø—Ä–∏–µ—Ö–∞–ª –Ω–∞ —Ä–∞–±–æ—Ç—É', '–ø—Ä–∏–±—ã–ª –Ω–∞ —Ä–∞–±–æ—Ç—É',
            '–Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É', '–Ω–∞ —Ä–∞–±–æ—Ç–µ',
            '—É—à–µ–ª —Å —Ä–∞–±–æ—Ç—ã', '—É—à—ë–ª —Å —Ä–∞–±–æ—Ç—ã',
            '–∑–∞–∫–æ–Ω—á–∏–ª —Ä–∞–±–æ—Ç—É'
        ],
        
        'CONTACT_MENTION': [
            '–≤—Å—Ç—Ä–µ—á–∞–ª—Å—è —Å', '–≤—Å—Ç—Ä–µ—á–∞–ª–∞—Å—å —Å',
            '—Å–æ–∑–≤–æ–Ω–∏–ª—Å—è —Å', '—Å–æ–∑–≤–æ–Ω–∏–ª–∞—Å—å —Å',
            '–≥–æ–≤–æ—Ä–∏–ª —Å', '–≥–æ–≤–æ—Ä–∏–ª–∞ —Å',
            '–æ–±—â–∞–ª—Å—è —Å', '–æ–±—â–∞–ª–∞—Å—å —Å',
            '–∑–≤–æ–Ω–∏–ª', '–∑–≤–æ–Ω–∏–ª–∞',
            '–¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å —Å', '–¥–æ–≥–æ–≤–æ—Ä–∏–ª–∞—Å—å —Å',
            '–≤—Å—Ç—Ä–µ—á–∞ —Å', '–∑–≤–æ–Ω–æ–∫ —Å'
        ],
        
        'TASK': [
            '–∑–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É', '–¥–æ–±–∞–≤—å –∑–∞–¥–∞—á—É',
            '–Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å', '–Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å',
            '–Ω–µ –∑–∞–±—ã—Ç—å', '–Ω–∞–ø–æ–º–Ω–∏',
            '–∑–∞–¥–∞—á–∞:', 'todo:',
            '—Å–¥–µ–ª–∞—Ç—å', '–∫—É–ø–∏—Ç—å'
        ],
        
        'PROJECT': [
            '—Å–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç', '–Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç',
            '–ø—Ä–æ–µ–∫—Ç:', '–Ω–∞—á–∞–ª –ø—Ä–æ–µ–∫—Ç'
        ],
        
        'HEALTH': [
            '—Å—ä–µ–ª', '—Å—ä–µ–ª–∞', '–ø–æ–µ–ª', '–ø–æ–µ–ª–∞',
            '–∫—É—Ä–∏–ª', '–∫—É—Ä–∏–ª–∞', '–ø–æ—à–µ–ª –∫—É—Ä–∏—Ç—å', '–ø–æ—à–ª–∞ –∫—É—Ä–∏—Ç—å',
            '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞', '–∑–∞–ª', '—Å–ø–æ—Ä—Ç',
            '—Å–ø–∞–ª', '—Å–ø–∞–ª–∞', '—Å–æ–Ω',
            '–≤—ã–ø–∏–ª', '–≤—ã–ø–∏–ª–∞'
        ],
        
        'CONTACT_REQUEST': [
            '—Å—Ä–∞–≤–Ω–∏ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏', '–º–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã',
            '–∫—Ç–æ —ç—Ç–æ', '–Ω–∞–π–¥–∏ –∫–æ–Ω—Ç–∞–∫—Ç',
            '–¥–æ–±–∞–≤—å –∫–æ–Ω—Ç–∞–∫—Ç', '–µ—Å—Ç—å –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö'
        ],
        
        'REPORT_REQUEST': [
            '–ø–æ–∫–∞–∂–∏ –æ—Ç—á–µ—Ç', '–ø–æ–∫–∞–∂–∏ –æ—Ç—á—ë—Ç',
            '–æ—Ç—á–µ—Ç –∑–∞', '–æ—Ç—á—ë—Ç –∑–∞',
            '—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', '–∞–Ω–∞–ª–∏—Ç–∏–∫–∞',
            '—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª', '—Ç—Ä–∞—Ç—ã'
        ],
        
        'SMALL_TALK': [
            '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '–∑–¥–æ—Ä–æ–≤–æ',
            '–∫–∞–∫ –¥–µ–ª–∞', '—Å–ø–∞—Å–∏–±–æ', '–æ–∫', '–æ–∫–µ–π',
            '–ø–æ–∫–∞', '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è'
        ]
    }
    
    def __init__(self):
        # –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º —Ä–µ–≥—É–ª—è—Ä–∫–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        self._compile_patterns()
    
    def _compile_patterns(self):
        """–ü—Ä–µ–¥–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞"""
        self.compiled_patterns = {}
        for intent, keywords in self.INTENT_KEYWORDS.items():
            # –°–æ–∑–¥–∞–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
            pattern = '|'.join(re.escape(kw) for kw in keywords)
            self.compiled_patterns[intent] = re.compile(pattern, re.IGNORECASE)
    
    def classify(self, text: str, has_photo: bool = False) -> Tuple[str, float]:
        """
        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–Ω—Ç–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
        
        Args:
            text: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            has_photo: –ï—Å—Ç—å –ª–∏ —Ñ–æ—Ç–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
        
        Returns:
            Tuple[intent, confidence]: –ò–Ω—Ç–µ–Ω—Ç –∏ —É—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (0.0-1.0)
        """
        if not text and has_photo:
            return ('RECEIPT', 0.95)
        
        if not text:
            return ('UNKNOWN', 0.0)
        
        text_lower = text.lower().strip()
        
        # –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π: —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º "—ç—Ç–æ —è –∫—É–ø–∏–ª"
        if has_photo:
            photo_keywords = ['–∫—É–ø–∏–ª', '–∫—É–ø–∏–ª–∞', '—á–µ–∫', '–ø–æ–∫—É–ø–∫–∞', '—Ç–æ–≤–∞—Ä']
            if any(kw in text_lower for kw in photo_keywords):
                return ('RECEIPT', 0.90)
            # –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–æ—Ç–æ –Ω–æ —Ç–µ–∫—Å—Ç –Ω–µ –ø—Ä–æ –ø–æ–∫—É–ø–∫–∏ - –≤–æ–∑–º–æ–∂–Ω–æ —Å–µ–ª—Ñ–∏ –∏ —Ç.–¥.
            # –ü–æ–∫–∞ —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —Ñ–æ—Ç–æ = —á–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            return ('RECEIPT', 0.70)
        
        # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ–Ω—Ç–∞
        scores = {}
        for intent, pattern in self.compiled_patterns.items():
            matches = pattern.findall(text_lower)
            if matches:
                # –ë–æ–ª—å—à–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π = –≤—ã—à–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
                score = min(len(matches) * 0.3 + 0.7, 1.0)
                scores[intent] = score
        
        if not scores:
            return ('UNKNOWN', 0.0)
        
        # –í—ã–±–∏—Ä–∞–µ–º –∏–Ω—Ç–µ–Ω—Ç —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º score
        best_intent = max(scores.items(), key=lambda x: x[1])
        return best_intent
    
    def extract_time(self, text: str) -> str:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Ä–µ–º—è –∏–∑ —Ç–µ–∫—Å—Ç–∞ (–¥–ª—è work_log).
        
        Examples:
            "–ø—Ä–∏—à–µ–ª –≤ 7.50" -> "07:50"
            "–ø—Ä–∏–µ—Ö–∞–ª –≤ 08:30" -> "08:30"
        """
        patterns = [
            r'–≤\s+(\d{1,2})[.:](\d{2})',  # "–≤ 7.50" –∏–ª–∏ "–≤ 8:30"
            r'(\d{1,2})[.:](\d{2})',       # "7.50" –∏–ª–∏ "8:30"
        ]
        
        for pattern in patterns:
            match = re.search(pattern, text)
            if match:
                hour = match.group(1).zfill(2)
                minute = match.group(2)
                return f"{hour}:{minute}"
        
        # –ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—É—â–µ–µ
        return datetime.now().strftime("%H:%M")
    
    def extract_person_name(self, text: str) -> str:
        """
        –ò–∑–≤–ª–µ—á—å –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞.
        
        Examples:
            "–≤—Å—Ç—Ä–µ—á–∞–ª—Å—è —Å –ê–Ω—Ç–æ–Ω–æ–º –ù–æ—Å–∫–æ–≤—ã–º" -> "–ê–Ω—Ç–æ–Ω –ù–æ—Å–∫–æ–≤"
            "–≥–æ–≤–æ—Ä–∏–ª —Å –ò–≤–∞–Ω–æ–º" -> "–ò–≤–∞–Ω"
        """
        patterns = [
            r'—Å\s+([–ê-–Ø–Å][–∞-—è—ë]+(?:\s+[–ê-–Ø–Å][–∞-—è—ë]+)?)',  # "—Å –ê–Ω—Ç–æ–Ω–æ–º –ù–æ—Å–∫–æ–≤—ã–º"
            r'–≤—Å—Ç—Ä–µ—á–∞–ª—Å—è\s+([–ê-–Ø–Å][–∞-—è—ë]+(?:\s+[–ê-–Ø–Å][–∞-—è—ë]+)?)',
            r'—Å–æ–∑–≤–æ–Ω–∏–ª—Å—è\s+([–ê-–Ø–Å][–∞-—è—ë]+(?:\s+[–ê-–Ø–Å][–∞-—è—ë]+)?)',
        ]
        
        for pattern in patterns:
            match = re.search(pattern, text)
            if match:
                return match.group(1).strip()
        
        return None
```

---

### –ú–û–î–£–õ–¨ 2: Contacts Manager (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏)

**–§–∞–π–ª:** `services/contacts_manager.py`

```python
"""
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏ –∏—Ö –∏—Å—Ç–æ—Ä–∏–µ–π.
–†–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
"""

from typing import List, Dict, Optional
from datetime import datetime, date
import re
from services.supabase_service import SupabaseService


class ContactsManager:
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –ü–æ–∏—Å–∫, —Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –∏—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π.
    """
    
    def __init__(self, db: SupabaseService):
        self.db = db
    
    async def find_contact(self, user_id: str, name: str) -> Optional[Dict]:
        """
        –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç –≤ –±–∞–∑–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏.
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
            name: –ò–º—è –¥–ª—è –ø–æ–∏—Å–∫–∞ (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
        
        Returns:
            Dict —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏–ª–∏ None
        """
        # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∏–º—è
        name_normalized = name.strip().lower()
        
        # –ò—â–µ–º –ø–æ –ø–æ–ª–Ω–æ–º—É –∏–º–µ–Ω–∏ (case-insensitive)
        result = await self.db.query(
            'contacts',
            {
                'user_id': user_id,
                'full_name__ilike': f'%{name}%'
            }
        )
        
        if not result:
            return None
        
        if len(result) == 1:
            return result[0]
        
        # –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π - –≤–µ—Ä–Ω—É—Ç—å —Å–∞–º–æ–µ —Ç–æ—á–Ω–æ–µ
        # (–≥–¥–µ –∏–º—è –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ)
        for contact in result:
            if contact['full_name'].lower().startswith(name_normalized):
                return contact
        
        # –ò–ª–∏ –≤–µ—Ä–Ω—É—Ç—å –ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        return result[0]
    
    async def create_contact(self, user_id: str, contact_data: Dict) -> Dict:
        """
        –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç.
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            contact_data: –î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
        
        Returns:
            –°–æ–∑–¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç
        """
        data = {
            'user_id': user_id,
            'full_name': contact_data.get('full_name'),
            'first_name': contact_data.get('first_name'),
            'last_name': contact_data.get('last_name'),
            'phone': contact_data.get('phone'),
            'email': contact_data.get('email'),
            'company': contact_data.get('company'),
            'position': contact_data.get('position'),
            'notes': contact_data.get('notes'),
            'created_at': datetime.now().isoformat()
        }
        
        result = await self.db.insert('contacts', data)
        return result
    
    async def add_interaction(
        self,
        user_id: str,
        contact_id: str,
        interaction_type: str,
        details: Dict
    ) -> Dict:
        """
        –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º.
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            contact_id: ID –∫–æ–Ω—Ç–∞–∫—Ç–∞
            interaction_type: –¢–∏–ø (meeting, call, message)
            details: –î–µ—Ç–∞–ª–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        
        Returns:
            –°–æ–∑–¥–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å
        """
        data = {
            'user_id': user_id,
            'contact_id': contact_id,
            'type': interaction_type,
            'title': details.get('title'),
            'description': details.get('description'),
            'location': details.get('location'),
            'interaction_date': details.get('date', date.today().isoformat()),
            'interaction_time': details.get('time'),
            'raw_text': details.get('raw_text'),
            'created_at': datetime.now().isoformat()
        }
        
        result = await self.db.insert('contact_interactions', data)
        return result
    
    async def get_interaction_history(
        self,
        user_id: str,
        contact_id: str,
        limit: int = 10
    ) -> List[Dict]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º.
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            contact_id: ID –∫–æ–Ω—Ç–∞–∫—Ç–∞
            limit: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
        
        Returns:
            List –∏—Å—Ç–æ—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
        """
        result = await self.db.query(
            'contact_interactions',
            {
                'user_id': user_id,
                'contact_id': contact_id
            },
            order_by='created_at',
            order='desc',
            limit=limit
        )
        
        return result or []
    
    async def update_context(
        self,
        user_id: str,
        contact_id: str,
        contact_name: str
    ):
        """
        –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π —É–ø–æ–º—è–Ω—É—Ç—ã–π –∫–æ–Ω—Ç–∞–∫—Ç).
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            contact_id: ID –∫–æ–Ω—Ç–∞–∫—Ç–∞
            contact_name: –ò–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
        """
        data = {
            'user_id': user_id,
            'last_mentioned_contact_id': contact_id,
            'last_mentioned_name': contact_name,
            'last_mention_time': datetime.now().isoformat(),
            'updated_at': datetime.now().isoformat()
        }
        
        # Upsert (insert or update)
        await self.db.upsert('conversation_context', data, ['user_id'])
    
    async def get_context(self, user_id: str) -> Optional[Dict]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
        Returns:
            Dict —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ None
        """
        result = await self.db.query(
            'conversation_context',
            {'user_id': user_id}
        )
        
        return result[0] if result else None
    
    def parse_person_name(self, text: str) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞.
        
        Examples:
            "–≤—Å—Ç—Ä–µ—á–∞–ª—Å—è —Å –ê–Ω—Ç–æ–Ω–æ–º –ù–æ—Å–∫–æ–≤—ã–º" -> "–ê–Ω—Ç–æ–Ω –ù–æ—Å–∫–æ–≤"
            "–≥–æ–≤–æ—Ä–∏–ª —Å –ò–≤–∞–Ω–æ–º" -> "–ò–≤–∞–Ω"
        """
        patterns = [
            r'—Å\s+([–ê-–Ø–Å][–∞-—è—ë]+(?:\s+[–ê-–Ø–Å][–∞-—è—ë]+)?)',
            r'–≤—Å—Ç—Ä–µ—á–∞–ª—Å—è\s+([–ê-–Ø–Å][–∞-—è—ë]+(?:\s+[–ê-–Ø–Å][–∞-—è—ë]+)?)',
            r'—Å–æ–∑–≤–æ–Ω–∏–ª—Å—è\s+([–ê-–Ø–Å][–∞-—è—ë]+(?:\s+[–ê-–Ø–Å][–∞-—è—ë]+)?)',
        ]
        
        for pattern in patterns:
            match = re.search(pattern, text)
            if match:
                return match.group(1).strip()
        
        return None
```

---

### –ú–û–î–£–õ–¨ 3: Contacts Handler (–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤)

**–§–∞–π–ª:** `handlers/contacts_handler.py`

```python
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.
"""

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes
from services.contacts_manager import ContactsManager
from services.supabase_service import SupabaseService
from datetime import datetime, date


class ContactsHandler:
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ª—é–¥–µ–π –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.
    """
    
    def __init__(self, db: SupabaseService):
        self.db = db
        self.contacts = ContactsManager(db)
    
    async def handle_mention(
        self,
        update: Update,
        context: ContextTypes.DEFAULT_TYPE
    ) -> str:
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞.
        
        Args:
            update: Telegram Update
            context: Telegram Context
        
        Returns:
            –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        """
        text = update.message.text
        user_id = str(update.effective_user.id)
        
        # 1. –ò–∑–≤–ª–µ—á—å –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞
        person_name = self.contacts.parse_person_name(text)
        
        if not person_name:
            return "‚ùì –ù–µ –ø–æ–Ω—è–ª, –æ –∫–æ–º —Ä–µ—á—å. –£–∫–∞–∂–∏—Ç–µ –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞."
        
        # 2. –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç –≤ –±–∞–∑–µ
        contact = await self.contacts.find_contact(user_id, person_name)
        
        if contact:
            # –ö–æ–Ω—Ç–∞–∫—Ç –Ω–∞–π–¥–µ–Ω - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
            await self._process_found_contact(
                user_id, contact, text, update, context
            )
            
            return self._format_contact_found(contact, text)
        
        else:
            # –ö–æ–Ω—Ç–∞–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–æ–±–∞–≤–∏—Ç—å
            await self._offer_add_contact(
                person_name, update, context
            )
            
            return f"‚ùì **{person_name}** –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö.\n" \
                   "–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å?"
    
    async def _process_found_contact(
        self,
        user_id: str,
        contact: dict,
        text: str,
        update: Update,
        context: ContextTypes.DEFAULT_TYPE
    ):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç:
        - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
        - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
        """
        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        interaction_type = self._detect_interaction_type(text)
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é
        await self.contacts.add_interaction(
            user_id=user_id,
            contact_id=contact['id'],
            interaction_type=interaction_type,
            details={
                'title': f"{interaction_type.title()} —Å {contact['full_name']}",
                'description': text,
                'raw_text': text,
                'date': date.today().isoformat(),
                'time': datetime.now().strftime("%H:%M")
            }
        )
        
        # –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (—ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–ø–æ–º—è–Ω—É—Ç—ã–π)
        await self.contacts.update_context(
            user_id=user_id,
            contact_id=contact['id'],
            contact_name=contact['full_name']
        )
    
    def _detect_interaction_type(self, text: str) -> str:
        """
        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ —Ç–µ–∫—Å—Ç—É.
        
        Returns:
            'meeting', 'call', 'message', 'email'
        """
        text_lower = text.lower()
        
        if any(kw in text_lower for kw in ['–≤—Å—Ç—Ä–µ—á–∞–ª—Å—è', '–≤—Å—Ç—Ä–µ—á–∞', '—É–≤–∏–¥–µ–ª–∏—Å—å']):
            return 'meeting'
        elif any(kw in text_lower for kw in ['—Å–æ–∑–≤–æ–Ω–∏–ª—Å—è', '–∑–≤–æ–Ω–∏–ª', '–∑–≤–æ–Ω–æ–∫']):
            return 'call'
        elif any(kw in text_lower for kw in ['–Ω–∞–ø–∏—Å–∞–ª', '—Å–æ–æ–±—â–µ–Ω–∏–µ']):
            return 'message'
        elif 'email' in text_lower or '–ø–∏—Å—å–º–æ' in text_lower:
            return 'email'
        else:
            return 'meeting'  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    def _format_contact_found(self, contact: dict, original_text: str) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–∞–∫—Ç –Ω–∞–π–¥–µ–Ω.
        """
        message = f"‚úÖ –ó–∞–ø–∏—Å–∞–Ω–æ: {original_text}\n\n"
        message += f"üë§ **{contact['full_name']}**\n"
        
        if contact.get('phone'):
            message += f"üì± {contact['phone']}\n"
        
        if contact.get('company'):
            message += f"üè¢ {contact['company']}"
            if contact.get('position'):
                message += f" ({contact['position']})"
            message += "\n"
        
        if contact.get('email'):
            message += f"üìß {contact['email']}\n"
        
        return message
    
    async def _offer_add_contact(
        self,
        person_name: str,
        update: Update,
        context: ContextTypes.DEFAULT_TYPE
    ):
        """
        –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç (—Å –∫–Ω–æ–ø–∫–æ–π).
        """
        keyboard = [
            [
                InlineKeyboardButton(
                    "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç",
                    callback_data=f"add_contact:{person_name}"
                )
            ],
            [
                InlineKeyboardButton(
                    "‚ùå –û—Ç–º–µ–Ω–∞",
                    callback_data="cancel"
                )
            ]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        await update.message.reply_text(
            f"‚ùì **{person_name}** –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –≤–∞—à–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö.\n"
            "–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å?",
            parse_mode='Markdown',
            reply_markup=reply_markup
        )
    
    async def handle_search_in_contacts(
        self,
        update: Update,
        context: ContextTypes.DEFAULT_TYPE
    ) -> str:
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å "—Å—Ä–∞–≤–Ω–∏ —Å –º–æ–∏–º–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏".
        """
        user_id = str(update.effective_user.id)
        
        # –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–ø–æ–º—è–Ω—É—Ç—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        ctx = await self.contacts.get_context(user_id)
        
        if not ctx or not ctx.get('last_mentioned_contact_id'):
            return "‚ùì –ù–µ –ø–æ–Ω—è–ª, –æ –∫–æ–º —Ä–µ—á—å. –°–Ω–∞—á–∞–ª–∞ —É–ø–æ–º—è–Ω–∏—Ç–µ —á–µ–ª–æ–≤–µ–∫–∞."
        
        contact_id = ctx['last_mentioned_contact_id']
        
        # –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
        contacts_list = await self.db.query(
            'contacts',
            {'id': contact_id}
        )
        
        if not contacts_list:
            return "‚ùì –ö–æ–Ω—Ç–∞–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω."
        
        contact = contacts_list[0]
        
        # –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
        history = await self.contacts.get_interaction_history(
            user_id=user_id,
            contact_id=contact_id,
            limit=5
        )
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
        message = f"üë§ **{contact['full_name']}** –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö!\n\n"
        
        if contact.get('phone'):
            message += f"üì± {contact['phone']}\n"
        if contact.get('company'):
            message += f"üè¢ {contact['company']}\n"
        if contact.get('email'):
            message += f"üìß {contact['email']}\n"
        
        if history:
            message += "\nüìú **–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**\n"
            for h in history[:3]:
                date_str = h['interaction_date']
                message += f"‚Ä¢ {date_str}: {h['type']} - {h.get('description', '')}\n"
        
        return message
```

---

### –ú–û–î–£–õ–¨ 4: Work Tracker (–£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)

**–§–∞–π–ª:** `handlers/work_tracker_handler.py`

```python
"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—á–µ—Ç–∞ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
"""

from telegram import Update
from telegram.ext import ContextTypes
from services.supabase_service import SupabaseService
from datetime import datetime, date
import re


class WorkTrackerHandler:
    """
    –£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏: –ø—Ä–∏—Ö–æ–¥, —É—Ö–æ–¥, –ø–µ—Ä–µ—Ä—ã–≤—ã.
    """
    
    def __init__(self, db: SupabaseService):
        self.db = db
    
    async def handle_work_log(
        self,
        update: Update,
        context: ContextTypes.DEFAULT_TYPE
    ) -> str:
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø–∏—Å—å –æ —Ä–∞–±–æ—á–µ–º –≤—Ä–µ–º–µ–Ω–∏.
        
        Args:
            update: Telegram Update
            context: Telegram Context
        
        Returns:
            –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
        """
        text = update.message.text
        user_id = str(update.effective_user.id)
        
        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
        log_type = self._detect_log_type(text)
        
        # –ò–∑–≤–ª–µ—á—å –≤—Ä–µ–º—è
        log_time = self._extract_time(text)
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
        await self.db.insert('work_logs', {
            'user_id': user_id,
            'log_type': log_type,
            'log_date': date.today().isoformat(),
            'log_time': log_time,
            'raw_text': text,
            'created_at': datetime.now().isoformat()
        })
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
        emoji = self._get_emoji(log_type)
        type_text = self._get_type_text(log_type)
        
        return f"{emoji} –ó–∞–ø–∏—Å–∞–Ω–æ: {type_text} –≤ {log_time}"
    
    def _detect_log_type(self, text: str) -> str:
        """
        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è.
        
        Returns:
            'arrival', 'departure', 'break_start', 'break_end'
        """
        text_lower = text.lower()
        
        if any(kw in text_lower for kw in ['–ø—Ä–∏—à–µ–ª', '–ø—Ä–∏—à—ë–ª', '–ø—Ä–∏–µ—Ö–∞–ª', '–ø—Ä–∏–±—ã–ª', '–Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É']):
            return 'arrival'
        elif any(kw in text_lower for kw in ['—É—à–µ–ª', '—É—à—ë–ª', '—É–µ—Ö–∞–ª', '–∑–∞–∫–æ–Ω—á–∏–ª —Ä–∞–±–æ—Ç—É']):
            return 'departure'
        elif '–ø–µ—Ä–µ—Ä—ã–≤' in text_lower:
            if '–Ω–∞—á–∞–ª' in text_lower or '–Ω–∞' in text_lower:
                return 'break_start'
            else:
                return 'break_end'
        else:
            return 'arrival'  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    def _extract_time(self, text: str) -> str:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Ä–µ–º—è –∏–∑ —Ç–µ–∫—Å—Ç–∞.
        
        Examples:
            "–ø—Ä–∏—à–µ–ª –≤ 7.50" -> "07:50"
            "–ø—Ä–∏–µ—Ö–∞–ª –≤ 08:30" -> "08:30"
        """
        patterns = [
            r'–≤\s+(\d{1,2})[.:](\d{2})',
            r'(\d{1,2})[.:](\d{2})',
        ]
        
        for pattern in patterns:
            match = re.search(pattern, text)
            if match:
                hour = match.group(1).zfill(2)
                minute = match.group(2)
                return f"{hour}:{minute}"
        
        # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
        return datetime.now().strftime("%H:%M")
    
    def _get_emoji(self, log_type: str) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å emoji –¥–ª—è —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è."""
        emojis = {
            'arrival': 'üü¢',
            'departure': 'üî¥',
            'break_start': '‚è∏Ô∏è',
            'break_end': '‚ñ∂Ô∏è'
        }
        return emojis.get(log_type, 'üìç')
    
    def _get_type_text(self, log_type: str) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞."""
        texts = {
            'arrival': '–ø—Ä–∏—Ö–æ–¥ –Ω–∞ —Ä–∞–±–æ—Ç—É',
            'departure': '—É—Ö–æ–¥ —Å —Ä–∞–±–æ—Ç—ã',
            'break_start': '–Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ä—ã–≤–∞',
            'break_end': '–∫–æ–Ω–µ—Ü –ø–µ—Ä–µ—Ä—ã–≤–∞'
        }
        return texts.get(log_type, '—Å–æ–±—ã—Ç–∏–µ')
```

---

### –ú–û–î–£–õ–¨ 5: Unified Handler (–ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä)

**–§–∞–π–ª:** `handlers/unified.py` (–ò–°–ü–†–ê–í–ò–¢–¨)

```python
"""
–ï–¥–∏–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –ø–æ –∏–Ω—Ç–µ–Ω—Ç–∞–º –ë–ï–ó –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Perplexity.
"""

from telegram import Update
from telegram.ext import ContextTypes
from services.intent_classifier import IntentClassifier
from services.supabase_service import SupabaseService
from handlers.contacts_handler import ContactsHandler
from handlers.work_tracker_handler import WorkTrackerHandler
from handlers.tasks_handler import TasksHandler
from handlers.projects_handler import ProjectsHandler
from handlers.health_handler import HealthHandler
from handlers.receipts_handler import ReceiptsHandler


class UnifiedHandler:
    """
    –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ–Ω—Ç –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∫ –Ω—É–∂–Ω–æ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É.
    """
    
    def __init__(self, db: SupabaseService):
        self.db = db
        self.classifier = IntentClassifier()
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        self.contacts_handler = ContactsHandler(db)
        self.work_tracker = WorkTrackerHandler(db)
        self.tasks_handler = TasksHandler(db)
        self.projects_handler = ProjectsHandler(db)
        self.health_handler = HealthHandler(db)
        self.receipts_handler = ReceiptsHandler(db)
    
    async def handle_message(
        self,
        update: Update,
        context: ContextTypes.DEFAULT_TYPE
    ):
        """
        –ì–ª–∞–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π.
        
        –≠—Ç–æ—Ç –º–µ—Ç–æ–¥:
        1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ–Ω—Ç –ë–ï–ó –≤–Ω–µ—à–Ω–∏—Ö API
        2. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∫ –Ω—É–∂–Ω–æ–º—É handler
        3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç (1-3 —Å—Ç—Ä–æ–∫–∏)
        """
        text = update.message.text if update.message.text else ""
        has_photo = bool(update.message.photo)
        user_id = str(update.effective_user.id)
        
        # 1. –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–Ω—Ç
        intent, confidence = self.classifier.classify(text, has_photo)
        
        # 2. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        await self._log_message(user_id, text, has_photo, intent, confidence)
        
        # 3. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å
        try:
            response = await self._route_to_handler(
                intent, update, context
            )
        except Exception as e:
            print(f"Error in handler: {e}")
            response = f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}"
        
        # 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
        await update.message.reply_text(
            response,
            parse_mode='Markdown'
        )
    
    async def _route_to_handler(
        self,
        intent: str,
        update: Update,
        context: ContextTypes.DEFAULT_TYPE
    ) -> str:
        """
        –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É –ø–æ –∏–Ω—Ç–µ–Ω—Ç—É.
        
        Args:
            intent: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–Ω—Ç
            update: Telegram Update
            context: Telegram Context
        
        Returns:
            –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        """
        
        # WORK_LOG: –£—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        if intent == 'WORK_LOG':
            return await self.work_tracker.handle_work_log(update, context)
        
        # CONTACT_MENTION: –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞
        elif intent == 'CONTACT_MENTION':
            return await self.contacts_handler.handle_mention(update, context)
        
        # CONTACT_REQUEST: –ó–∞–ø—Ä–æ—Å –ø–æ–∏—Å–∫–∞ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö
        elif intent == 'CONTACT_REQUEST':
            return await self.contacts_handler.handle_search_in_contacts(
                update, context
            )
        
        # TASK: –ó–∞–¥–∞—á–∞
        elif intent == 'TASK':
            return await self.tasks_handler.handle_freeform_task(
                update, context
            )
        
        # PROJECT: –ü—Ä–æ–µ–∫—Ç
        elif intent == 'PROJECT':
            return await self.projects_handler.handle_freeform_project(
                update, context
            )
        
        # HEALTH: –ó–¥–æ—Ä–æ–≤—å–µ
        elif intent == 'HEALTH':
            return await self.health_handler.handle_freeform(
                update, context
            )
        
        # RECEIPT: –ß–µ–∫ (—Ñ–æ—Ç–æ)
        elif intent == 'RECEIPT':
            return await self.receipts_handler.analyze_receipt(
                update, context
            )
        
        # REPORT_REQUEST: –ó–∞–ø—Ä–æ—Å –æ—Ç—á–µ—Ç–∞
        elif intent == 'REPORT_REQUEST':
            # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç—á–µ—Ç–æ–≤
            return "üìä –û—Ç—á–µ—Ç—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã /task list, /health report"
        
        # SMALL_TALK: –û–±—ã—á–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä
        elif intent == 'SMALL_TALK':
            return self._handle_small_talk(update.message.text)
        
        # UNKNOWN: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–Ω—Ç–µ–Ω—Ç
        else:
            return self._handle_unknown(update.message.text)
    
    def _handle_small_talk(self, text: str) -> str:
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ–±—ã—á–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä.
        """
        text_lower = text.lower()
        
        if '–ø—Ä–∏–≤–µ—Ç' in text_lower or '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π' in text_lower:
            return "üëã –ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?"
        elif '—Å–ø–∞—Å–∏–±–æ' in text_lower:
            return "üôÇ –†–∞–¥ –ø–æ–º–æ—á—å!"
        elif '–ø–æ–∫–∞' in text_lower:
            return "üëã –î–æ –≤—Å—Ç—Ä–µ—á–∏!"
        else:
            return "üòä –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
    
    def _handle_unknown(self, text: str) -> str:
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
        """
        return (
            "‚ùì –ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n"
            '‚Ä¢ "–∑–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É: ..."\n'
            '‚Ä¢ "—Å–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç ..."\n'
            '‚Ä¢ "–ø—Ä–∏—à–µ–ª –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ X:XX"\n'
            '‚Ä¢ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —á–µ–∫–∞\n'
            '‚Ä¢ /help –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏'
        )
    
    async def _log_message(
        self,
        user_id: str,
        text: str,
        has_photo: bool,
        intent: str,
        confidence: float
    ):
        """
        –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ ML.
        """
        try:
            await self.db.insert('message_history', {
                'user_id': user_id,
                'message_text': text,
                'has_photo': has_photo,
                'detected_intent': intent,
                'intent_confidence': confidence,
                'created_at': datetime.now().isoformat()
            })
        except:
            pass  # –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –µ—Å–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

### –ú–û–î–£–õ–¨ 6: Main (–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞)

**–§–∞–π–ª:** `main.py` (–ò–°–ü–†–ê–í–ò–¢–¨)

```python
"""
–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞.
"""

import os
import logging
from telegram import Update
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    CallbackQueryHandler,
    filters
)

from config import Config
from services.supabase_service import SupabaseService
from handlers.commands import CommandsHandler
from handlers.unified import UnifiedHandler

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)


async def post_init(application: Application):
    """–î–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞."""
    logger.info("Bot started successfully!")


def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞."""
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    config = Config()
    db = SupabaseService(
        url=config.SUPABASE_URL,
        key=config.SUPABASE_SERVICE_ROLE_KEY
    )
    
    # –°–æ–∑–¥–∞—Ç—å Application
    application = Application.builder().token(config.TELEGRAM_BOT_TOKEN).build()
    
    # Handlers
    commands_handler = CommandsHandler(db)
    unified_handler = UnifiedHandler(db)
    
    # ===========================================
    # –ö–û–ú–ê–ù–î–´
    # ===========================================
    application.add_handler(
        CommandHandler("start", commands_handler.start)
    )
    application.add_handler(
        CommandHandler("help", commands_handler.help_command)
    )
    
    # ===========================================
    # –¢–ï–ö–°–¢–û–í–´–ï –°–û–û–ë–©–ï–ù–ò–Ø
    # ===========================================
    # ‚ö†Ô∏è –í–ê–ñ–ù–û: –í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∫—Ä–æ–º–µ –∫–æ–º–∞–Ω–¥)
    # –∏–¥—É—Ç –≤ UnifiedHandler, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ–Ω—Ç
    # –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –ë–ï–ó Perplexity
    application.add_handler(
        MessageHandler(
            filters.TEXT & ~filters.COMMAND,
            unified_handler.handle_message
        )
    )
    
    # ===========================================
    # –§–û–¢–û
    # ===========================================
    # –§–æ—Ç–æ —Ç–æ–∂–µ –∏–¥–µ—Ç –≤ UnifiedHandler
    # (–æ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —á—Ç–æ —ç—Ç–æ —á–µ–∫ –∏ –ø–µ—Ä–µ–¥–∞—Å—Ç –≤ ReceiptsHandler)
    application.add_handler(
        MessageHandler(
            filters.PHOTO,
            unified_handler.handle_message
        )
    )
    
    # ===========================================
    # CALLBACK QUERIES (–∫–Ω–æ–ø–∫–∏)
    # ===========================================
    # TODO: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    # (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç")
    
    # Post init
    application.post_init = post_init
    
    # –ó–∞–ø—É—Å–∫
    logger.info("Starting bot...")
    application.run_polling(allowed_updates=Update.ALL_TYPES)


if __name__ == '__main__':
    main()
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

```python
"""
–§–∞–π–ª: tests/test_intent_classifier.py
"""

import pytest
from services.intent_classifier import IntentClassifier


class TestIntentClassifier:
    
    @pytest.fixture
    def classifier(self):
        return IntentClassifier()
    
    def test_work_log_arrival(self, classifier):
        """–¢–µ—Å—Ç: –ü—Ä–∏—Ö–æ–¥ –Ω–∞ —Ä–∞–±–æ—Ç—É"""
        intent, conf = classifier.classify("–ü—Ä–∏—à–µ–ª –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ 7.50")
        assert intent == 'WORK_LOG'
        assert conf > 0.7
    
    def test_contact_mention(self, classifier):
        """–¢–µ—Å—Ç: –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞"""
        intent, conf = classifier.classify(
            "–í—Å—Ç—Ä–µ—á–∞–ª—Å—è –≤—á–µ—Ä–∞ —Å –ê–Ω—Ç–æ–Ω–æ–º –ù–æ—Å–∫–æ–≤—ã–º"
        )
        assert intent == 'CONTACT_MENTION'
        assert conf > 0.7
    
    def test_receipt_photo(self, classifier):
        """–¢–µ—Å—Ç: –§–æ—Ç–æ —á–µ–∫–∞"""
        intent, conf = classifier.classify("", has_photo=True)
        assert intent == 'RECEIPT'
        assert conf > 0.9
    
    def test_task(self, classifier):
        """–¢–µ—Å—Ç: –ó–∞–¥–∞—á–∞"""
        intent, conf = classifier.classify(
            "–ó–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É: –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ"
        )
        assert intent == 'TASK'
        assert conf > 0.7
    
    def test_small_talk(self, classifier):
        """–¢–µ—Å—Ç: –û–±—ã—á–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä"""
        intent, conf = classifier.classify("–ü—Ä–∏–≤–µ—Ç")
        assert intent == 'SMALL_TALK'
        assert conf > 0.7
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# =========================================
# –¢–ï–°–¢ 1: –†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
# =========================================
USER: "–ü—Ä–∏—à–µ–ª –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ 7.50"
EXPECTED: "üü¢ –ó–∞–ø–∏—Å–∞–Ω–æ: –ø—Ä–∏—Ö–æ–¥ –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ 07:50"

# =========================================
# –¢–ï–°–¢ 2: –ö–æ–Ω—Ç–∞–∫—Ç
# =========================================
USER: "–í—Å—Ç—Ä–µ—á–∞–ª—Å—è –≤—á–µ—Ä–∞ —Å –ê–Ω—Ç–æ–Ω–æ–º –ù–æ—Å–∫–æ–≤—ã–º, –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å —Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è"
EXPECTED:
"‚úÖ –ó–∞–ø–∏—Å–∞–Ω–æ: –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è –≤—á–µ—Ä–∞ —Å –ê–Ω—Ç–æ–Ω–æ–º –ù–æ—Å–∫–æ–≤—ã–º...

üë§ **–ê–Ω—Ç–æ–Ω –ù–æ—Å–∫–æ–≤**
üì± +7...
üè¢ –ö–∞–º—á–∞—Ç–∫–∞"

# =========================================
# –¢–ï–°–¢ 3: –ü–æ–∏—Å–∫ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö
# =========================================
USER: "–°—Ä–∞–≤–Ω–∏ —Å –º–æ–∏–º–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏"
EXPECTED: –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É–ø–æ–º—è–Ω—É—Ç–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞

# =========================================
# –¢–ï–°–¢ 4: –ß–µ–∫
# =========================================
USER: (–æ—Ç–ø—Ä–∞–≤–∏–ª —Ñ–æ—Ç–æ —á–µ–∫–∞)
EXPECTED:
"üßæ –ß–µ–∫: –ü—è—Ç—ë—Ä–æ—á–∫–∞, 385‚ÇΩ, 3 —Ç–æ–≤–∞—Ä–∞
‚Ä¢ –ú–æ–ª–æ–∫–æ 90‚ÇΩ
‚Ä¢ –•–ª–µ–± 45‚ÇΩ
‚Ä¢ –§–∏–ª–µ 250‚ÇΩ"

# =========================================
# –¢–ï–°–¢ 5: –ó–∞–¥–∞—á–∞
# =========================================
USER: "–ó–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É: –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ –¥–æ –ø—è—Ç–Ω–∏—Ü—ã"
EXPECTED: "‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞: –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ (–¥–µ–¥–ª–∞–π–Ω: –ø—Ç)"

# =========================================
# –¢–ï–°–¢ 6: –û–±—ã—á–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä
# =========================================
USER: "–ü—Ä–∏–≤–µ—Ç"
EXPECTED: "üëã –ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?"

# =========================================
# –¢–ï–°–¢ 7: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ
# =========================================
USER: "asdfghjkl"
EXPECTED: "‚ùì –ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: ..."
```

---

## üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö"
# –≤ Supabase SQL Editor
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install python-telegram-bot==20.7
pip install supabase==2.0.0
pip install python-dotenv
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å .env

```bash
TELEGRAM_BOT_TOKEN=your_bot_token
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
python main.py
```

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

```
1. /start
2. "–ü—Ä–∏—à–µ–ª –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ 8:00"
3. "–í—Å—Ç—Ä–µ—á–∞–ª—Å—è —Å –ò–≤–∞–Ω–æ–º –ò–≤–∞–Ω–æ–≤—ã–º"
4. (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ —á–µ–∫–∞)
5. "–ó–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É: –ø–æ–∑–≤–æ–Ω–∏—Ç—å –ò–≤–∞–Ω—É"
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

- [ ] **–£–î–ê–õ–ò–¢–¨/–û–¢–ö–õ–Æ–ß–ò–¢–¨** –≤—Å–µ –≤—ã–∑–æ–≤—ã Perplexity API –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [ ] **–°–û–ó–î–ê–¢–¨** `services/intent_classifier.py`
- [ ] **–°–û–ó–î–ê–¢–¨** `services/contacts_manager.py`
- [ ] **–°–û–ó–î–ê–¢–¨** `handlers/contacts_handler.py`
- [ ] **–°–û–ó–î–ê–¢–¨** `handlers/work_tracker_handler.py`
- [ ] **–ò–°–ü–†–ê–í–ò–¢–¨** `handlers/unified.py` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IntentClassifier)
- [ ] **–°–û–ó–î–ê–¢–¨** —Ç–∞–±–ª–∏—Ü—ã –ë–î (SQL –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
- [ ] **–ò–°–ü–†–ê–í–ò–¢–¨** `main.py` (—Ä–æ—É—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ UnifiedHandler)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
- [ ] –ü—Ä–æ–π—Ç–∏ –≤—Å–µ 7 —Ä—É—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Perplexity –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —á–µ–∫–æ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ ] –û–±–Ω–æ–≤–∏—Ç—å README.md
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –û–ø–∏—Å–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `python main.py` –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î: –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã?
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env: –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã?
4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ —à–∞–≥–∞–º: —Å–Ω–∞—á–∞–ª–∞ intent_classifier, –ø–æ—Ç–æ–º handlers

---

**–°—Ç–∞—Ç—É—Å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê  
**Deadline:** 14 –¥–µ–∫–∞–±—Ä—è 2025, 18:00 MSK  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** HIGHEST  

> üéØ **–¶–ï–õ–¨: –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –±–æ—Ç –≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –∏—Å—Ç–æ—Ä–∏–µ–π!**
